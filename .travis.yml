language: node_js
node_js:
  - 'node'
env:
  - EXTENSION_ID=hlepfoohegkhhmjieoechaddaejaokhf
deploy:
  - provider: script
    skip_cleanup: true
    script: npm run release
    on:
      tags: true
  - provider: script
    skip_cleanup: true
    script: npm run release
    on:
      # Set to deploy on: cron with recent commits
      branch: master
      condition: $(npm run can-release --silent)
after_success:
  - |

       declare -r SSH_FILE="$(mktemp -u $HOME/.ssh/XXXXX)"

       # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

       # Decrypt the file containing the private key

       openssl aes-256-cbc \
         -K $encrypted_132e22846a88_key \
         -iv $encrypted_132e22846a88_iv \
         -in ".travis/github_deploy_key.enc" \
         -out "$SSH_FILE" -d

       # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

       # Enable SSH authentication

       chmod 600 "$SSH_FILE" \
         && printf "%s\n" \
              "Host github.com" \
              "  IdentityFile $SSH_FILE" \
              "  LogLevel ERROR" >> ~/.ssh/config
